{"version":3,"file":"clipboard-more.js","sourceRoot":"../../..","sources":["components/ux/clipboard/clipboard-more.ts"],"sourcesContent":["// #todo\r\n\r\n// Simple Set Clipboard System\r\n// Author: Joseph Huckaby\r\n\r\n// https://github.com/jonrohan/ZeroClipboard\r\n\r\n/**\r\n * 表示一个 Flash 复制工具。\r\n */\r\nmodule ZeroClipboard {\r\n\r\n    /**\r\n     * 配置当前使用的 Flash 文件。\r\n     * @private\r\n     */\r\n    export var moviePath = 'resources/ZeroClipboard.swf';\r\n\r\n    /**\r\n     * 初始化指定节点为复制按钮。\r\n     * @param {Object} options 相关的配置。具体支持的字段有：\r\n     * * @param {Element} dom 指定复制按钮节点。\r\n     * * @param {mixed} [text] 要复制的文本或返回要复制文本的函数。其参数为：\r\n     * * * @param {Element} dom 当前相关的节点。\r\n     * * * @return {String} 返回要复制的文本。\r\n     * * @param {Element} [input] 要复制的文本域。\r\n     * * @param {Function} [callback] Flash 统一事件回调。\r\n     * * @param {Function} [mouseover] 鼠标移到按钮上的回调。\r\n     * * @param {Function} [mouseout] 鼠标移出按钮上的回调。\r\n     * * @param {Function} [success] 复制成功的回调。\r\n     * * @param {Number} [delay=100] 等待 Flash 加载的延时。\r\n     */\r\n    export function init(options) {\r\n\r\n        var dom = options.dom;\r\n\r\n        function getContent() {\r\n            if (options.text instanceof Function) {\r\n                return options.text(dom);\r\n            }\r\n            if (options.input) {\r\n                return options.input.value;\r\n            }\r\n            return options.text;\r\n        }\r\n\r\n        // IE: 运行剪贴板操作。\r\n        if ((window as any).clipboardData) {\r\n            dom.addEventListener(\"click\", function () {\r\n                (window as any).clipboardData.setData(\"Text\", getContent());\r\n            }, false);\r\n            return;\r\n        }\r\n\r\n        // 基于 Flash 复制。\r\n        if (location.protocol !== 'file:' && navigator.plugins && navigator.plugins[\"Shockwave Flash\"]) {\r\n\r\n            var timer;\r\n\r\n            // 鼠标移入 100 毫秒后加载 Flash 动画。\r\n            dom.addEventListener(\"mouseover\", function () {\r\n                timer = setTimeout(function () {\r\n                    timer = 0;\r\n\r\n                    // 初始化复制 FLASH。\r\n                    if (!ZeroClipboard.movie) {\r\n                        var div = document.createElement('div');\r\n                        div.style.position = 'absolute';\r\n                        div.style.zIndex = 300000 as any;\r\n                        div.innerHTML = '<embed id=\"zeroClipboard\" style=\"position:absolute;top:0;\" src=\"' + ZeroClipboard.moviePath + '\" loop=\"false\" menu=\"false\" quality=\"best\" bgcolor=\"#ffffff\" width=\"' + dom.offsetWidth + '\" height=\"' + dom.offsetHeight + '\" name=\"zeroClipboard\" align=\"middle\" allowScriptAccess=\"always\" allowFullScreen=\"false\" type=\"application/x-shockwave-flash\" pluginspage=\"http://www.macromedia.com/go/getflashplayer\" flashvars=\"' + 'id=zeroClipboard&width=' + dom.offsetWidth + '&height=' + dom.offsetHeight + '\" wmode=\"transparent\" />';\r\n                        document.body.appendChild(div);\r\n                        ZeroClipboard.movie = document.getElementById('zeroClipboard');\r\n                    }\r\n\r\n                    // 设置回调。\r\n                    ZeroClipboard.dispatch = function (id, eventName, args) {\r\n\r\n                        // 设置复制的内容。\r\n                        if ((eventName === \"load\" || eventName === \"mouseOver\") && ZeroClipboard.movie.setText) {\r\n                            ZeroClipboard.movie.setText(getContent());\r\n                        }\r\n\r\n                        var triggerType = eventName === \"mouseOver\" ? \"mouseover\" : eventName === 'mouseOut' ? \"mouseout\" : eventName === 'complete' ? \"success\" : null;\r\n                        triggerType && options[triggerType] && options[triggerType](id, eventName, args);\r\n                        options.callback && options.callback(id, eventName, args);\r\n                    };\r\n\r\n                    // 设置按钮样式。\r\n                    ZeroClipboard.dispatch(null, 'mouseOver');\r\n\r\n                    // 设置flash样式。\r\n                    var div = window.ZeroClipboard.movie.parentNode;\r\n                    var rect = dom.getBoundingClientRect();\r\n                    div.style.left = rect.left + (window.pageXOffset || window.scrollX) + 'px';\r\n                    div.style.top = rect.top + (window.pageXOffset || window.scrollY) + 'px';\r\n\r\n                }, options.delay || 100);\r\n            }, false);\r\n\r\n            // 鼠标移出后不操作。\r\n            dom.addEventListener(\"mouseout\", function () {\r\n                if (timer) {\r\n                    clearTimeout(timer);\r\n                    timer = 0;\r\n                }\r\n                ZeroClipboard.dispatch(null, 'mouseOut');\r\n            }, false);\r\n\r\n            return;\r\n        }\r\n\r\n        dom.addEventListener(\"click\", function () {\r\n            if (options.input) {\r\n                alert(\"由于安全限制，自动复制失败。请按 Ctrl+C 手动复制\");\r\n                options.input.focus();\r\n                options.input.select();\r\n            } else {\r\n                prompt(\"请直接按 Ctrl+C 复制: \", getContent());\r\n            }\r\n        }, false);\r\n\r\n    }\r\n\r\n}\r\n\r\nexport = ZeroClipboard;"],"mappings":"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"}