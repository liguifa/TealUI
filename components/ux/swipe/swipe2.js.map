{"version":3,"file":"swipe2.js","sourceRoot":"../../..","sources":["components/ux/swipe/swipe2.ts"],"sourcesContent":["// #todo\r\n\r\n/**\r\n * @author xuld@vip.qq.com\r\n */\r\n\r\ntypeof include === \"function\" && include(\"base.js\");\r\n\r\n/**\r\n * 创建一个新的可滑动区域。\r\n * @param {Element} elem 要拖动的元素。\r\n * @param {Object} options 用户覆盖可拖动对象的配置。\r\n */\r\nfunction Swippable(elem, options) {\r\n\r\n    var me = this;\r\n\r\n    me.elem = elem;\r\n\r\n    // 使用用户自定义配置覆盖默认配置。\r\n    for (var key in options) {\r\n        me[key] = options[key];\r\n    }\r\n\r\n    me.elem.on('mousedown', me.handlerMouseDown, me);\r\n\r\n}\r\n\r\nSwippable.prototype = {\r\n    constructor: Swippable,\r\n\r\n    /**\r\n     * 设置当前拖动的节点。\r\n     */\r\n    elem: null,\r\n\r\n    /**\r\n     * 当前滑动的状态。0：未滑动；1：水平滑动；2：垂直滑动。\r\n     */\r\n    state: 0,\r\n\r\n    /**\r\n     * 产生滑动事件的最少步长。\r\n     */\r\n    step: 10,\r\n\r\n    /**\r\n     * 区分垂直滑动或水平滑动的角度。\r\n     */\r\n    ratio: .5,\r\n\r\n    longTapTimeout: 1000,\r\n\r\n    /**\r\n     * 处理 mousedown 事件。\r\n     * 初始化拖动，当单击时，执行这个函数，但不触发 dragStart。\r\n     * 只有鼠标移动时才会继续触发 dragStart。\r\n     * @param {Event} e 事件参数。\r\n     */\r\n    handlerMouseDown: function (e) {\r\n\r\n        // 只处理左键拖动。\r\n        if (e.which === 1) {\r\n\r\n            var me = this;\r\n\r\n            me.state = 0;\r\n            me.startX = e.pageX;\r\n            me.startY = e.pageY;\r\n\r\n            // 绑定拖动和停止拖动事件。\r\n            var doc = me.elem.ownerDocument;\r\n            doc.on('mouseup', me.handlerMouseUp, me);\r\n            doc.on('mousemove', me.handlerMouseMove, me);\r\n\r\n            // 开始监听长时间按住时间。\r\n            if (me.onLongTap || me.onShortTap) {\r\n                me.longTapTimer = setTimeout(function () {\r\n                    if (me.state === 0) {\r\n                        me.handlerMouseUp(e);\r\n                        me.onLongTap && me.onLongTap(e);\r\n                        me.longTapTimer = 0;\r\n                    }\r\n                }, me.longTapTimeout);\r\n            }\r\n\r\n        }\r\n\r\n    },\r\n\r\n    /**\r\n     * 处理 mousemove 事件。\r\n     * @param {Event} e 事件参数。\r\n     */\r\n    handlerMouseMove: function (e) {\r\n\r\n        var me = this;\r\n\r\n        me.endX = e.pageX;\r\n        me.endY = e.pageY;\r\n\r\n        if (me.state === 0) {\r\n\r\n            var deltaX = me.endX - me.startX,\r\n                deltaY = me.endY - me.startY;\r\n\r\n            // 滑动范围太小，忽略滑动。\r\n            if (deltaX * deltaX + deltaY * deltaY < me.step * me.step) {\r\n                return;\r\n            }\r\n\r\n            // 开始进入滑动状态。\r\n            me.state = Math.abs(deltaY / deltaX) < me.ratio ? 1 : 2;\r\n\r\n            // 开始滑动事件。\r\n            me.onSwipeStart && me.onSwipeStart(e);\r\n\r\n        } else {\r\n            me.onSwipeMove && me.onSwipeMove(e);\r\n        }\r\n\r\n    },\r\n\r\n    /**\r\n     * 处理 mouseup 事件。\r\n     * @param {Event} e 事件参数。\r\n     * 这个函数调用 onDragEnd 和 afterDrag\r\n     */\r\n    handlerMouseUp: function (e) {\r\n\r\n        // 只有鼠标左键松开， 才认为是停止拖动。\r\n        if (e.which === 1) {\r\n\r\n            var me = this;\r\n\r\n            // 绑定拖动和停止拖动事件。\r\n            var doc = me.elem.ownerDocument;\r\n            doc.off('mousemove', me.handlerMouseMove);\r\n            doc.off('mouseup', me.handlerMouseUp);\r\n\r\n            if (me.state === 0) {\r\n                if (me.longTapTimer) {\r\n                    clearTimeout(me.longTapTimer);\r\n                    me.longTapTimer = 0;\r\n                    me.onShortTap && me.onShortTap(e);\r\n                }\r\n                me.onTap && me.onTap(e);\r\n            } else {\r\n                me.onSwipeEnd && me.onSwipeEnd(e);\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n\r\n};\r\n\r\n/**\r\n * 滑动元素事件。\r\n * @param {Element} elem 滑动的元素。\r\n * @param {Options} options 各个方向滑动的处理函数。\r\n */\r\nElement.prototype.setSwippable = function (options) {\r\n    var data = Element.getData(this);\r\n    return data.swippable || (data.swippable = new Swippable(this, options));\r\n};\r\n"],"mappings":"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"}