{"version":3,"file":"xswipe.js","sourceRoot":"../../..","sources":["components/ux/swipe/xswipe.ts"],"sourcesContent":["// #todo\r\n\r\n/**\r\n * @author xuld@vip.qq.com\r\n */\r\n\r\n /**\r\n                     * 将容器直接子节点作为列表进行自动轮播。\r\n                     * @param {Element} elem 滚动的容器节点。一般是 <ul> 元素。\r\n                     * @param {Number} interval=0 自动轮播的间隔时间，如果为 0 则不自动轮播。\r\n                     * @param {Boolean} touchMove=true 是否启用滑动轮播。\r\n                     * @remark 限制：\r\n                     * - 只能在  Webkit 内核的手机浏览器使用。\r\n                     * - 所有子节点必须和容器等宽。\r\n                     * - 一次只能移动一张。\r\n                     */\r\n function XSwipe(elem, interval, touchMove) {\r\n\r\n                        // 全局参数。\r\n                        var indicatorActived = '#ddd';\r\n                        var indicatorInactived = '#000';\r\n\r\n                        // 计算布局信息。\r\n                        var childCount = elem.children.length;\r\n                        var containerWidth = elem.offsetWidth;\r\n\r\n                        // 不处理只有一张图片的情况。\r\n                        if (childCount < 2 || !containerWidth) {\r\n                            return;\r\n                        }\r\n\r\n                        var allWidth = containerWidth * childCount;\r\n\r\n                        // 生成容器。\r\n                        var container = elem.ownerDocument.createElement('div');\r\n                        container.style.position = 'relative';\r\n                        container.style.overflow = 'hidden';\r\n                        container.style.width = containerWidth + 'px';\r\n\r\n                        // 生成指示器。\r\n                        var html = '';\r\n                        for (var i = 0; i < childCount; i++) {\r\n                            html += '<li style=\"width:8px;height:8px;display:inline-block;border-radius:100%;background-color:#000; opacity:.2;margin:0 .375em;\"></li>';\r\n                        }\r\n                        container.innerHTML = '<ul style=\"list-style:none;text-align:center;padding:0;position:absolute;bottom:5px;left:0;margin:0;width:100%;\">' + html + '</ul>';\r\n\r\n                        // 将 elem 替换为 container。\r\n                        elem.parentNode.replaceChild(container, elem);\r\n                        container.insertBefore(elem, container.firstChild);\r\n\r\n                        // 复制首尾张。\r\n                        var newFirst = elem.firstElementChild.cloneNode(true);\r\n                        var newLast = elem.lastElementChild.cloneNode(true);\r\n                        elem.insertBefore(newLast, elem.firstChild);\r\n                        elem.appendChild(newFirst);\r\n\r\n                        // 设置子元素的宽度。\r\n                        for (var node = elem.firstElementChild; node; node = node.nextElementSibling) {\r\n                            node.style.float = 'left';\r\n                            node.style.width = containerWidth + 'px';\r\n                        }\r\n\r\n                        // 设置容器宽度。\r\n                        elem.style.position = 'relative';\r\n                        elem.style.clear = 'left';\r\n                        elem.style.width = '10000px';\r\n\r\n                        var currentIndex = 0;\r\n                        var timer;\r\n\r\n                        // 绑定滑动事件。\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\tif(touchMove == null){\r\n\t\t\t\t\t\t\ttouchMove = navigator.userAgent.indexOf('HUAWEI') < 0;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif(touchMove !== false){\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tvar from;\r\n\t\t\t\t\t\t\tvar delta;\r\n\t\t\t\t\t\t\tvar fromScroll;\r\n\t\t\t\t\t\t\tcontainer.addEventListener('touchstart', function (e) {\r\n\t\t\t\t\t\t\t\tif (elem.style.webkitTransition) return;\r\n\t\t\t\t\t\t\t\tfrom = e.touches[0].clientX;\r\n\t\t\t\t\t\t\t\tfromScroll = getScroll();\r\n\t\t\t\t\t\t\t}, false);\r\n\r\n\t\t\t\t\t\t\tcontainer.addEventListener('touchmove', function (e) {\r\n\t\t\t\t\t\t\t\tif (elem.style.webkitTransition) return;\r\n\t\t\t\t\t\t\t\tdelta = from - e.touches[0].clientX;\r\n\t\t\t\t\t\t\t\t// 忽略小范围点击。\r\n\t\t\t\t\t\t\t\tif (delta < 2 && delta >= -2) {\r\n\t\t\t\t\t\t\t\t\tdelta = 0;\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tsetScroll(fromScroll + delta);\r\n\t\t\t\t\t\t\t}, false);\r\n\r\n\t\t\t\t\t\t\tcontainer.addEventListener('touchend', function (e) {\r\n\t\t\t\t\t\t\t\tif (!delta || elem.style.webkitTransition) {\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tanimteTo(~~(fromScroll / containerWidth) - 1 + (-40 < delta && delta < 40 ? 0 : delta > 0 ? 1 : -1))\r\n\t\t\t\t\t\t\t}, false);\r\n\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n                        function getScroll() {\r\n                            return -(/(\\-?\\d+(\\.\\d*)?),\\s*\\-?\\d+(\\.\\d*)?\\)$/.exec(getComputedStyle(elem, null).webkitTransform) || [0, 0])[1];\r\n                        }\r\n\r\n                        function setScroll(value) {\r\n                            elem.style.webkitTransform = 'translateX(' + -value + 'px) translateZ(0)';\r\n                        }\r\n\r\n                        // 设置当前索引。\r\n                        function setIndex(index) {\r\n                            currentIndex = index;\r\n                            var nodes = container.lastChild.childNodes;\r\n                            for (var i = 0; i < nodes.length; i++) {\r\n                                nodes[i].style.backgroundColor = i === index ? indicatorActived : indicatorInactived;\r\n                            }\r\n                        }\r\n\r\n                        // 通过渐变方式移到到指定帧。\r\n                        function animteTo(index) {\r\n\r\n                            if (timer) {\r\n                                clearTimeout(timer);\r\n                                timer = 0;\r\n                            }\r\n\r\n                            // 渐变结束后停止渐变。\r\n                            var transitionEnd = function () {\r\n                                if (!elem.style.webkitTransition) return;\r\n                                elem.removeEventListener('webkitTransitionEnd', transitionEnd, false);\r\n                                elem.style.webkitTransition = '';\r\n\r\n                                // 修复帧外为帧内。\r\n                                var scroll = getScroll();\r\n                                if (scroll < containerWidth || scroll >= allWidth + containerWidth) {\r\n                                    setScroll(scroll < containerWidth ? scroll + allWidth : scroll >= allWidth + containerWidth ? scroll - allWidth : scroll);\r\n                                }\r\n\r\n                            };\r\n\r\n                            elem.addEventListener('webkitTransitionEnd', transitionEnd, false);\r\n                            setTimeout(transitionEnd, 400);\r\n\r\n                            // 设置渐变。\r\n                            elem.style.webkitTransition = '-webkit-transform .3s';\r\n                            setScroll((index + 1) * containerWidth);\r\n                            setIndex(index < 0 ? index + childCount : index >= childCount ? index - childCount : index);\r\n\r\n                            autoStart();\r\n                        }\r\n\r\n                        function autoStart() {\r\n                            if (interval) {\r\n                                timer = setTimeout(function () {\r\n                                    animteTo(currentIndex + 1);\r\n                                }, interval);\r\n                            }\r\n                        }\r\n\r\n                        // 默认显示第一张。\r\n                        setScroll(containerWidth);\r\n                        setIndex(0);\r\n                        autoStart();\r\n\r\n                    }\r\n"],"mappings":"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"}