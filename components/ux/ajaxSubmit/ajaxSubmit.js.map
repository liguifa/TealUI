{"version":3,"file":"ajaxSubmit.js","sourceRoot":"../../..","sources":["components/ux/ajaxSubmit/ajaxSubmit.ts"],"sourcesContent":["import ajax, { Ajax } from \"ux/ajax\";\r\n\r\n/**\r\n * Ajax 异步提交表单。\r\n * @param formElem 要提交的表单元素。\r\n * @param success 成功回调函数。\r\n * @param error 错误回调函数。\r\n * @param options 附加的额外选项。\r\n * @return 如果未设置任何回调函数则返回一个确认对象。\r\n * @example ajaxSubmit(document.getElementById(\"form\"))\r\n */\r\nexport default function ajaxSubmit(formElem: HTMLFormElement, success?: Ajax[\"success\"], error?: Ajax[\"error\"], options?: Partial<Ajax>) {\r\n\treturn ajax({\r\n\t\ttype: formElem.method,\r\n\t\turl: formElem.action,\r\n\t\tcontentType: formElem.enctype,\r\n\t\twithCredentials: true,\r\n\t\tdata: formData(formElem),\r\n\t\tsuccess: success,\r\n\t\terror: error,\r\n\t\t...options\r\n\t});\r\n}\r\n\r\n/**\r\n * 获取表单的数据。\r\n * @param formElem 表单元素。\r\n * @param disabled 是否包含被禁用的元素。\r\n * @return 返回表单数据。\r\n * @example formData(document.getElementById(\"form\"))\r\n */\r\nexport function formData(formElem: HTMLFormElement, disabled = false) {\r\n\tconst result: { [key: string]: string | string[] } = {};\r\n\tlet formData: FormData | undefined;\r\n\tfor (const input of formElem as any as (HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement)[]) {\r\n\t\tconst name = input.name;\r\n\t\tif (name && (disabled || !input.disabled)) {\r\n\t\t\tswitch (input.type) {\r\n\t\t\t\tcase \"select-multiple\":\r\n\t\t\t\t\tfor (const option of (input as HTMLSelectElement).options as any as HTMLOptionElement[]) {\r\n\t\t\t\t\t\tif (option.selected) {\r\n\t\t\t\t\t\t\taddValue(result, name, option.value || option.text);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"radio\":\r\n\t\t\t\t\tif ((input as HTMLInputElement).checked) {\r\n\t\t\t\t\t\taddValue(result, name, input.value || \"on\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"checkbox\":\r\n\t\t\t\t\tif ((input as HTMLInputElement).checked) {\r\n\t\t\t\t\t\taddValue(result, name, input.value || \"on\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"file\":\r\n\t\t\t\t\tformData = formData || new FormData();\r\n\t\t\t\t\tif ((input as HTMLInputElement).files) {\r\n\t\t\t\t\t\tfor (const file of (input as HTMLInputElement).files! as any as File[]) {\r\n\t\t\t\t\t\t\tformData.append(name, file);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\taddValue(result, name, input.value);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif (formData) {\r\n\t\tfor (const key in result) {\r\n\t\t\tconst value = result[key];\r\n\t\t\tif (Array.isArray(value)) {\r\n\t\t\t\tfor (const item of value) {\r\n\t\t\t\t\tformData.append(key, item);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tformData.append(key, value);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn formData;\r\n\t}\r\n\treturn result;\r\n}\r\n\r\nfunction addValue(result: { [key: string]: string | string[] }, key: string, value: string) {\r\n\tconst exists = result[key];\r\n\tif (Array.isArray(exists)) {\r\n\t\texists.push(value);\r\n\t} else if (exists != undefined) {\r\n\t\tresult[key] = [exists, value];\r\n\t} else {\r\n\t\tresult[key] = value;\r\n\t}\r\n}\r\n"],"mappings":"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"}