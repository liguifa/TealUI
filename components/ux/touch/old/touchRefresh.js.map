{"version":3,"file":"touchRefresh.js","sourceRoot":"../../../..","sources":["components/ux/touch/old/touchRefresh.ts"],"sourcesContent":["/**\r\n * refresh \r\n * @author @Ctrip.com\r\n * @statable\r\n */\r\n\r\n/**\r\n * refresh \r\n * @author @Ctrip.com\r\n * @statable\r\n */\r\n.scroll-transition {\r\n    -webkit-transition: .15s ease;\r\n}\r\n.scroll-transition2 {\r\n    -webkit-transition: .35s ease;\r\n}\r\n/**\r\n * Created by huangjianhua on 2016/7/4.\r\n */\r\n\r\nimport './refresh.css';\r\n\r\nfunction refreshPage(obj) {\r\n\r\n    var $target = obj.target,\r\n        refreshCallback = obj.refreshCallback,\r\n        startCallback = obj.startCallback,\r\n        moveCallback = obj.moveCallback,\r\n        endCallback = obj.endCallback,\r\n        onShow = obj.onShow,\r\n        scope = obj.scope,\r\n        initAction = obj.init;\r\n\r\n\r\n    var startY, moveY, moveEndY, firstPos, lastPos, firstTouch_obj, cur_top,\r\n        startTimeStamp, endTimeStamp;\r\n\r\n    var $scroll_section = $target;\r\n    var $scroll_loading = $('.refresh-loading');\r\n    var $scroll_title = $('.section-title');\r\n    var init_top = 0;  //初始的top\r\n    var loading_title_height = $scroll_loading.height();\r\n\r\n\r\n    $target.on('touchstart', function (e) {\r\n        startTimeStamp = e.timeStamp || Date.now();\r\n        //title contain\r\n\r\n        //判断是否已经展开， 展开  return\r\n        if($('.flight-info-detail').length > 0)  return;\r\n\r\n\r\n        //初始触摸的点\r\n        firstTouch_obj = e.touches[0];\r\n        moveY = 0;\r\n        firstPos = {y: firstTouch_obj.clientY};   //第一个开始scroll的坐标\r\n        cur_top = 0;  //当前的scroll区域的top\r\n\r\n        //开始拖动时清除动画缓冲效果\r\n        $scroll_section.removeClass('scroll-transition');\r\n        $scroll_section.removeClass('scroll-transition2');\r\n\r\n\r\n//        console.log('start clientY: ', firstTouch_obj.clientY, 'pageY:', firstTouch_obj.pageY);\r\n    }).on('touchmove', function (e) {\r\n        //e.preventDefault();\r\n        //判断是否已经展开， 展开  return\r\n        if($('.flight-info-detail').length > 0)  return;\r\n\r\n        var lastTouch_obj = e.touches[0];\r\n        lastPos = {y: lastTouch_obj.clientY};   //第一个开始scroll的坐标\r\n\r\n\r\n        //判断是向上滑动还是向下滑动\r\n        moveY = lastPos.y - firstPos.y;\r\n\r\n        var scrollTop = $('.viewport-scroll')[0].scrollTop;\r\n\r\n        if(moveY > 0 && (scrollTop<=2)) {\r\n            $scroll_loading.css('z-index', 22).show();\r\n\r\n            //$scroll_section.css('top', (cur_top + moveY) + 'px');\r\n            $scroll_section.css('transition', 'translateY('+ (cur_top + moveY) +'px)');\r\n            $scroll_section.css('-webkit-transform', 'translateY('+ (cur_top + moveY) +'px) ');\r\n\r\n        } else {\r\n            $scroll_loading.hide();\r\n        }\r\n\r\n\r\n\r\n    }).on('touchend', function (e) {\r\n        if($('.flight-info-detail').length > 0)  return;\r\n\r\n//            firstPos = null;  //重置第一个开始模拟滚动标记的坐标点\r\n        endTimeStamp = e.timeStamp || Date.now();\r\n\r\n        console.log('moveY:--- ' + moveY + ' scrolltop : ' + $target[0].scrollTop);\r\n\r\n        var scrollTop = $('.viewport-scroll')[0].scrollTop;\r\n\r\n        if(moveY> 0 && (scrollTop<=2) )  {\r\n                //拖动的区里大于设定刷新的距离则刷新，且为正数,\r\n                if ((cur_top + moveY) > 0 && (cur_top + moveY) < 0) {\r\n                    $scroll_section.addClass('scroll-transition');\r\n                    //$scroll_section.css('top', init_top + 'px');\r\n                    $scroll_section.css('transition', 'translateY('+ (init_top) +'px) ');\r\n                    $scroll_section.css('-webkit-transform', 'translateY('+ (init_top) +'px) ');\r\n                    //如果css动画结束 ，还原\r\n                    return;\r\n                }\r\n\r\n                //refresh\r\n                else if ((cur_top + moveY) > init_top) {\r\n                    $scroll_section.addClass('scroll-transition2'); // 设置缓冲的class\r\n\r\n                    //还原到loading状态\r\n                    //$scroll_section.css('top', (init_top ) + 'px');\r\n                    $scroll_section.css('transition', 'translateY('+ (init_top+loading_title_height) +'px) ');\r\n                    $scroll_section.css('-webkit-transform', 'translateY('+ (init_top+loading_title_height) +'px) ');\r\n                    $target && $target[0] && ($target[0].scrollTop = 0);\r\n                    //$scroll_title.html('正在为你获取最新信息');\r\n\r\n                    //刷新后的回调，还原到初始状态\r\n                    function resultCallback() {\r\n                        setTimeout(function () {\r\n                        }, 1500);\r\n\r\n                        //$scroll_section.css('top', init_top + 'px');\r\n                        $scroll_section.css('transition', 'translateY('+ (init_top) +'px) ');\r\n                        $scroll_section.css('-webkit-transform', 'translateY('+ (init_top) +'px) ');\r\n                        $target && $target[0] && ($target[0].scrollTop = 0);\r\n                        //$scroll_title.html('下拉获取最新信息');\r\n                        //title contain\r\n                        $scroll_loading.css('z-index', -1).hide();\r\n\r\n                    }\r\n\r\n                    //刷新页面\r\n                    refreshCallback({\r\n                        noShowLoading: true,\r\n                        noInit: true,\r\n                        onShow:onShow,\r\n                        scope:scope,\r\n                        initAction: initAction,\r\n                        resultCallback: resultCallback\r\n                    });\r\n\r\n\r\n\r\n\r\n                }\r\n\r\n        }\r\n\r\n\r\n\r\n\r\n\r\n    });\r\n\r\n}\r\n\r\n\r\nmodule.exports.refreshPage = refreshPage;"],"mappings":"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"}