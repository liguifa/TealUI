{"version":3,"file":"dialog.js","sourceRoot":"../../..","sources":["components/ui/dialog/dialog.tsx"],"sourcesContent":["import * as dom from \"ux/dom\";\r\nimport draggable, { Draggable } from \"ux/drag\";\r\nimport Control, { bind, VNode, NodeLike } from \"ui/control\";\r\nimport \"typo/icon\";\r\nimport \"typo/close\";\r\nimport \"ui/panel\";\r\nimport \"./dialog.scss\";\r\n\r\n/**\r\n * 表示一个对话框。\r\n */\r\nexport default class Dialog extends Control {\r\n\r\n    protected render() {\r\n        return <div class=\"x-dialog\" style=\"display: none\">\r\n            <section class=\"x-panel\">\r\n                <header class=\"x-panel-header\">\r\n                    <button class=\"x-close x-icon\" title=\"关闭\" aria-label=\"关闭\">✖</button>\r\n                    <h5></h5>\r\n                </header>\r\n                <div class=\"x-panel-body\">\r\n                </div>\r\n            </section>\r\n        </div>;\r\n    }\r\n\r\n    /**\r\n     * 头部。\r\n     */\r\n    @bind(\".x-panel-header\") header: HTMLElement;\r\n\r\n    /**\r\n     * 标题。\r\n     */\r\n    @bind(\".x-panel-header h5\", \"innerHTML\") title: NodeLike;\r\n\r\n    /**\r\n     * 是否可关闭。\r\n     */\r\n    @bind(\".x-panel-header .x-close\", \"hidden\") hideClose: boolean;\r\n\r\n    @bind(\".x-panel-body\") body: HTMLElement;\r\n\r\n    /**\r\n     * 内容。\r\n     */\r\n    @bind(\".x-panel-body\", \"innerHTML\") content: NodeLike;\r\n\r\n    protected init() {\r\n        const close = dom.find(this.header, \".x-close\");\r\n        if (close) {\r\n            dom.on(close, \"click\", this.handleCloseClick, this);\r\n        }\r\n        this.draggable = true;\r\n    }\r\n\r\n    /**\r\n     * 当点击关闭按钮后执行。\r\n     */\r\n    protected handleCloseClick() {\r\n        this.close();\r\n    }\r\n\r\n    /**\r\n     * 切换显示的动画。\r\n     */\r\n    animation: dom.ToggleAnimation;\r\n\r\n    /**\r\n     * 切换显示的动画目标。\r\n     */\r\n    target?: HTMLElement;\r\n\r\n    /**\r\n     * 显示当前对话框。\r\n     * @param target 显示的目标。\r\n     */\r\n    show(target?: HTMLElement) {\r\n        if (target) {\r\n            this.target = target;\r\n        } else {\r\n            target = this.target;\r\n        }\r\n        dom.ready(() => {\r\n            if (!dom.contains(document.body, this.elem)) {\r\n                document.body.appendChild(this.elem);\r\n            }\r\n            if (this.hidden) {\r\n                dom.show(this.elem);\r\n                dom.show(this.find(\".x-panel\") as HTMLElement, this.animation, undefined, this.duration, undefined, target);\r\n                dom.addClass(document.body, \"x-dialog-open\");\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 关闭当前对话框。\r\n     * @param target 关闭的目标。\r\n     */\r\n    close(target?: HTMLElement) {\r\n        if (target) {\r\n            this.target = target;\r\n        } else {\r\n            target = this.target;\r\n        }\r\n        if (!this.onBeforeClose || this.onBeforeClose() !== false) {\r\n            this.elem.style.backgroundColor = \"transparent\";\r\n            dom.hide(this.find(\".x-panel\") as HTMLElement, this.animation, () => {\r\n                this.elem.style.backgroundColor = \"\";\r\n                dom.removeClass(document.body, \"x-dialog-open\");\r\n                this.renderTo(null);\r\n                this.onClose && this.onClose();\r\n            }, this.duration, undefined, target);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 即将关闭对话框事件。\r\n     */\r\n    onBeforeClose: () => boolean | void;\r\n\r\n    /**\r\n     * 关闭对话框事件。\r\n     */\r\n    onClose: () => void;\r\n\r\n    private _draggable: Draggable;\r\n\r\n    /**\r\n     * 是否可拖动。\r\n     */\r\n    get draggable() {\r\n        return !!this._draggable;\r\n    }\r\n    set draggable(value) {\r\n        dom.toggleClass(this.elem, \"x-dialog-draggable\", value);\r\n        if (value) {\r\n            if (this._draggable) {\r\n                this._draggable.enable();\r\n            } else {\r\n                this._draggable = draggable(this.find(\".x-panel\") as HTMLElement, {\r\n                    handle: this.find(\".x-panel-header h5\") as HTMLElement,\r\n                    onDragStart: () => {\r\n                        if (!this._draggable.elem.style.margin) {\r\n                            const rect = dom.getRect(this._draggable.elem);\r\n                            this._draggable.elem.style.margin = \"0\";\r\n                            dom.setRect(this._draggable.elem, rect);\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n        } else if (this._draggable) {\r\n            this._draggable.disable();\r\n        }\r\n    }\r\n\r\n}\r\n\r\nDialog.prototype.animation = \"scale\";\r\n"],"mappings":"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"}