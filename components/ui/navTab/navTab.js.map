{"version":3,"file":"navTab.js","sourceRoot":"../../..","sources":["components/ui/navTab/navTab.tsx"],"sourcesContent":["import * as dom from \"ux/dom\";\r\nimport { scrollSize, scrollBy, scrollIntoViewIfNeeded } from \"ux/scroll\";\r\nimport Control, { VNode, bind } from \"ui/control\";\r\nimport \"typo/icon/icon.scss\";\r\nimport \"typo/close/close.scss\";\r\nimport \"./navTab.scss\";\r\n\r\n/**\r\n * 表示一个导航标签页。\r\n */\r\nexport default class NavTab extends Control {\r\n\r\n    protected render() {\r\n        return <nav class=\"x-navtab\">\r\n            <a href=\"javascript:;\" class=\"x-icon x-navtab-left\" style=\"display: none;\" onClick={this.handleScrollClick}>⮜</a>\r\n            <a href=\"javascript:;\" class=\"x-icon x-navtab-right\" style=\"display: none;\" onClick={this.handleScrollClick}>⮞</a>\r\n            <div class=\"x-navtab-body\" onScroll={this.handleScroll} onMouseWheel={this.handleMouseWheel}>\r\n                <div class=\"x-navtab-bar\" style=\"left: 0;\"></div>\r\n                <ul role=\"tablist\"></ul>\r\n            </div>\r\n        </nav>;\r\n    }\r\n\r\n    protected init() {\r\n        dom.on(this.container, \"click\", \"li\", this.handleItemClick, this);\r\n        dom.on(this.container, \"pointerup\", \"li\", this.handleItemPointerUp, this);\r\n    }\r\n\r\n    @bind(\".x-navtab-left\") scrollLeftHandle: HTMLElement;\r\n    @bind(\".x-navtab-right\") scrollRightHandle: HTMLElement;\r\n\r\n    @bind(\".x-navtab-body\") body: HTMLElement;\r\n\r\n    /**\r\n     * 标签页容器。\r\n     */\r\n    @bind(\".x-navtab-body ul\") container: HTMLElement;\r\n\r\n    @bind(\".x-navtab-bar\") activeBar: HTMLElement;\r\n\r\n    /**\r\n     * 添加一个标签页。\r\n     */\r\n    addTab(tab: string, active = true) {\r\n        const item = dom.parse(`<li role=\"tab\"><button class=\"x-close x-icon\" title=\"关闭\" aria-label=\"关闭\">✖</button><a href=\"javascript:;\"></a></li>`) as HTMLElement;\r\n        const body = item.lastChild as HTMLElement;\r\n        body.title = body.textContent = tab || \"　\";\r\n        this.container.appendChild(item);\r\n        this.realign(active ? item : undefined);\r\n        return item;\r\n    }\r\n\r\n    /**\r\n     * 删除一个标签页。\r\n     */\r\n    removeTab(tabItem: HTMLElement) {\r\n        const newTab = this.activeTab === tabItem && (dom.next(tabItem) || dom.prev(tabItem));\r\n        dom.find(tabItem, \".x-close\")!.style.opacity = \"0\";\r\n        dom.animate(tabItem, { width: 0 }, () => {\r\n            dom.remove(tabItem);\r\n            this.realign(newTab ? newTab : undefined);\r\n            this.onCloseTab && this.onCloseTab(tabItem);\r\n        }, this.duration);\r\n    }\r\n\r\n    tabMaxWidth: number;\r\n\r\n    tabMinWidth: number;\r\n\r\n    /**\r\n     * 根据标签页的实际大小调整分配。\r\n     */\r\n    realign(activeTab = this.activeTab) {\r\n        const containerWidth = this.body.offsetWidth;\r\n        if (containerWidth) {\r\n            const tabCount = this.container.childNodes.length;\r\n            const width = Math.max(Math.min(containerWidth / tabCount, this.tabMaxWidth), this.tabMinWidth);\r\n            for (let node = this.container.firstChild as HTMLElement; node; node = node.nextSibling as HTMLElement) {\r\n                node.style.width = width + \"px\";\r\n            }\r\n            this.activeBar.style.width = width + \"px\";\r\n            const overflow = width * tabCount > containerWidth;\r\n            dom.toggle(this.scrollLeftHandle, overflow);\r\n            dom.toggle(this.scrollRightHandle, overflow);\r\n            this.activeTab = activeTab;\r\n\r\n            // 隐藏最后一个标签的 x \r\n            //第一个标签是激活标签的时候不应该隐藏关闭按钮\r\n            const hideClose = dom.first(this.container) == dom.last(this.container) && activeTab != dom.first(this.container);\r\n            this.query(\".x-close\").forEach((c: HTMLElement) => {\r\n                dom.toggle(c, !hideClose);\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 激活的标签页。\r\n     */\r\n    get activeTab() {\r\n        return this.find(\".x-navtab-active\") as HTMLElement | null;\r\n    }\r\n    set activeTab(value) {\r\n        const active = this.activeTab;\r\n        if (active) {\r\n            dom.removeClass(active, \"x-navtab-active\");\r\n            active.setAttribute(\"aria-selected\", \"false\");\r\n        }\r\n        if (value) {\r\n            dom.addClass(value, \"x-navtab-active\");\r\n            value.setAttribute(\"aria-selected\", \"false\");\r\n            scrollIntoViewIfNeeded(value, this.body, this.duration);\r\n            this.activeBar.style.left = (parseFloat(value.style.width!) + 7) * dom.index(value) + \"px\";\r\n            this.onActiveTab && this.onActiveTab(value);\r\n        }\r\n    }\r\n\r\n    protected handleItemClick = (e: MouseEvent, item: HTMLElement) => {\r\n        if (dom.hasClass(e.target as HTMLElement, \"x-close\")) {\r\n            this.removeTab(item);\r\n        } else {\r\n            this.activeTab = item;\r\n        }\r\n    }\r\n\r\n    scrollSize: number;\r\n\r\n    protected handleScrollClick = (e: MouseEvent) => {\r\n        const left = dom.hasClass(e.target as HTMLElement, \"x-navtab-left\");\r\n        scrollBy(this.body, { x: this.scrollSize * (left ? -1 : 1) }, this.duration);\r\n    }\r\n\r\n    protected handleMouseWheel = (e: WheelEvent) => {\r\n        scrollBy(this.body, { x: -e.wheelDelta }, this.duration);\r\n    }\r\n\r\n    protected handleScroll = (e: MouseEvent) => {\r\n        dom.toggleClass(this.scrollLeftHandle, \"x-navtab-disabled\", this.body.scrollLeft === 0);\r\n        dom.toggleClass(this.scrollRightHandle, \"x-navtab-disabled\", this.body.scrollLeft + this.body.offsetWidth >= this.body.scrollWidth);\r\n    }\r\n\r\n    protected handleItemPointerUp = (e: MouseEvent, item: HTMLElement) => {\r\n        if (e.which === 2) {\r\n            this.removeTab(item);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 关闭标签事件。\r\n     */\r\n    onCloseTab: (item: HTMLElement) => void;\r\n\r\n    /**\r\n     * 激活标签事件。\r\n     */\r\n    onActiveTab: (item: HTMLElement) => void;\r\n\r\n}\r\n\r\nNavTab.prototype.tabMaxWidth = 140;\r\nNavTab.prototype.tabMinWidth = 80;\r\nNavTab.prototype.scrollSize = 100;\r\n"],"mappings":"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"}