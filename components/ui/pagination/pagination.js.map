{"version":3,"file":"pagination.js","sourceRoot":"../../..","sources":["components/ui/pagination/pagination.tsx"],"sourcesContent":["import * as dom from \"ux/dom\";\r\nimport Control, { VNode, bind } from \"ui/control\";\r\nimport { ListItem } from \"ui/listBox\";\r\nimport ComboBox from \"ui/comboBox\";\r\nimport TextBox from \"ui/textBox\";\r\nimport { NormalizedValidityResult } from \"ui/input\";\r\nimport pagination from \"ux/pagination\";\r\nimport \"./pagination.scss\";\r\n\r\n/**\r\n * 表示一个分页。\r\n */\r\nexport default class Pagination extends Control {\r\n\r\n    /**\r\n     * 总条数。\r\n     */\r\n    @bind total: number;\r\n\r\n    /**\r\n     * 每页显示的条数。\r\n     */\r\n    @bind pageSize = 20;\r\n\r\n    /**\r\n     * 总页数。\r\n     */\r\n    get pageCount() {\r\n        return this.total ? Math.ceil(this.total / this.pageSize) : 1;\r\n    }\r\n    set pageCount(value) {\r\n        this.total = this.pageSize * value;\r\n    }\r\n\r\n    /**\r\n     * 当前页码。页码从 1 开始。\r\n     */\r\n    @bind currentPage = 1;\r\n\r\n    /**\r\n     * 首尾保留的页数。\r\n     */\r\n    @bind minCount = 2;\r\n\r\n    /**\r\n     * 最多显示的页数（不含上一页和下一页）。建议设置为奇数。\r\n     */\r\n    @bind maxCount = 7;\r\n\r\n    /**\r\n     * 是否显示总条数。\r\n     */\r\n    @bind showTotal = true;\r\n\r\n    /**\r\n     * 是否显示页面大小切换器。\r\n     */\r\n    @bind showSizeChanger = true;\r\n\r\n    /**\r\n     * 页面切换器显示的页码。\r\n     */\r\n    @bind sizeChangerItems = [10, 20, 30];\r\n\r\n    /**\r\n     * 是否显示上一页。\r\n     */\r\n    @bind showPrevPage = true;\r\n\r\n    /**\r\n     * 是否显示页码。\r\n     */\r\n    @bind showPagination = true;\r\n\r\n    /**\r\n     * 是否显示下一页。\r\n     */\r\n    @bind showNextPage = true;\r\n\r\n    /**\r\n     * 是否显示快速跳转。\r\n     */\r\n    @bind showQuickJumper = true;\r\n\r\n    protected render() {\r\n        let html = \"\";\r\n        const append = (tpl: string, page: any) => {\r\n            html += tpl.replace(/{page}/g, page);\r\n        };\r\n\r\n        if (this.showPrevPage) {\r\n            append(this.currentPage <= 1 ? Pagination.locale.prevDisabled : Pagination.locale.prev, this.currentPage - 1);\r\n        }\r\n        if (this.showPagination) {\r\n            pagination(this.pageCount, this.currentPage, (page, ellipsis) => {\r\n                if (ellipsis) {\r\n                    html += Pagination.locale.ellipsis;\r\n                } else {\r\n                    append(page === this.currentPage ? Pagination.locale.itemDisabled : Pagination.locale.item, page);\r\n                }\r\n            });\r\n        }\r\n        if (this.showNextPage) {\r\n            append(this.currentPage >= this.pageCount ? Pagination.locale.nextDisabled : Pagination.locale.next, this.currentPage + 1);\r\n        }\r\n\r\n        return <nav class=\"x-pagination\">\r\n            <div class=\"x-pagination-header\">\r\n                {this.showSizeChanger ? [\"每页条数：\",\r\n                    <ComboBox class=\"x-pagination-sizechanger\" value={this.pageSize.toString()} onChange={this.handleSizeChange} pattern={/^\\d+$/} hideSuccess>\r\n                        {this.sizeChangerItems.map(item => <ListItem>{item}</ListItem>)}\r\n                    </ComboBox>] : null}\r\n                {this.showTotal ? ` 共 ${this.total || 0} 条` : \"\"}\r\n            </div>\r\n            {this.showQuickJumper ? <form class=\"x-pagination-footer\" onSubmit={this.handleQuickJumperClick}>\r\n                跳至：<TextBox type=\"number\" class=\"x-textbox x-pagination-quickjumper\" value={this.currentPage.toString()} min={1} max={this.pageCount} hideSuccess /> 页\r\n                &nbsp;<input type=\"submit\" class=\"x-button x-page-goto-page\" value=\"跳转\" style=\"min-width: 60px;\" />\r\n            </form> : null}\r\n            <div class=\"x-pagination-body\" innerHTML={html} onClick={this.handleClick}></div>\r\n        </nav>;\r\n    }\r\n\r\n    /**\r\n     * 存储本地化文案配置。\r\n     */\r\n    static locale = {\r\n        item: `<a href=\"javascript://第 {page} 页\" title=\"转到：第 {page} 页\" data-value=\"{page}\">{page}</a>`,\r\n        itemDisabled: `<a class=\"x-pagination-active\">{page}</a>`,\r\n        prev: `<a href=\"javascript://第 {page} 页\" class=\"x-pagination-prev\" title=\"转到：第 {page} 页\" data-value=\"{page}\"><i class=\"x-icon\">⮜</i>上一页</a>`,\r\n        prevDisabled: ``,\r\n        next: `<a href=\"javascript://第 {page} 页\" class=\"x-pagination-next\" title=\"转到：第 {page} 页\" data-value=\"{page}\">下一页 <i class=\"x-icon\">⮞</i></a>`,\r\n        nextDisabled: ``,\r\n        ellipsis: ` ... `\r\n    };\r\n\r\n    /**\r\n     * 处理页码点击事件。\r\n     * @param e 相关事件参数。\r\n     */\r\n    protected handleClick = (e: MouseEvent) => {\r\n        const page = +(e.target as HTMLElement).getAttribute(\"data-value\")!;\r\n        if (page) {\r\n            this.select(page);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 处理快速跳转事件。\r\n     * @param e 相关事件参数。\r\n     */\r\n    protected handleQuickJumperClick = (e: UIEvent) => {\r\n        e.preventDefault();\r\n        const input = this.find(\".x-pagination-quickjumper\") as TextBox;\r\n        if ((input.reportValidity() as NormalizedValidityResult).valid) {\r\n            this.select(+input.value);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 处理页面改变事件。\r\n     * @param e 相关事件参数。\r\n     */\r\n    protected handleSizeChange = (e: UIEvent) => {\r\n        const input = this.find(\".x-pagination-sizechanger\") as ComboBox;\r\n        if ((input.reportValidity() as NormalizedValidityResult).valid) {\r\n            this.select(undefined, +input.value);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 切换到指定的页码和页大小。\r\n     * @param page 页码。\r\n     * @param pageSize 页大小。\r\n     */\r\n    select(page = this.currentPage, pageSize = this.pageSize) {\r\n        if ((!this.onSelect || this.onSelect(page, pageSize, this) !== false) && this.currentPage !== page) {\r\n            this.currentPage = page;\r\n            this.onChange && this.onChange(page, pageSize, this);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 切换页码或页大小事件。\r\n     * @param page 新的页码。\r\n     * @param pageSize 新的页大小。\r\n     * @param sender 事件源。\r\n     * @return 如果事件返回 false 则阻止切换。\r\n     */\r\n    onSelect: (page: number, pageSize: number, sender: this) => boolean | void;\r\n\r\n    /**\r\n     * 更改页面或页大小事件。\r\n     * @param page 新的页码。\r\n     * @param pageSize 新的页大小。\r\n     * @param sender 事件源。\r\n     */\r\n    onChange: (page: number, pageSize: number, sender: this) => void;\r\n\r\n}\r\n"],"mappings":"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"}