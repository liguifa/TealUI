{"version":3,"file":"accordion.js","sourceRoot":"../../..","sources":["components/ui/accordion/accordion.tsx"],"sourcesContent":["import * as dom from \"ux/dom\";\r\nimport Control, { VNode, bind } from \"ui/control\";\r\nimport Panel from \"ui/panel\";\r\nimport \"./accordion.scss\";\r\n\r\n/**\r\n * 表示一个手风琴。\r\n */\r\nexport default class Accordion extends Control {\r\n\r\n    /**\r\n     * 是否允许同时开多个面板。\r\n     */\r\n    multiply: boolean;\r\n\r\n    /**\r\n     * 切换折叠事件。\r\n     * @param panel 当前展开的面板。\r\n     * @param sender 事件源。\r\n     */\r\n    onCollapseChange: (panel: Panel, sender: this) => void;\r\n\r\n    /**\r\n     * 选中的索引。\r\n     */\r\n    get selectedIndex() { return this.panels.findIndex(panel => !panel.collapsed); }\r\n    set selectedIndex(value) {\r\n        this.panels.forEach((panel, index) => {\r\n            panel.collapsed = index !== value;\r\n        });\r\n    }\r\n\r\n    protected render() {\r\n        return <div class=\"x-accordion\"></div>;\r\n    }\r\n\r\n    @bind(\"\") body: HTMLElement;\r\n\r\n    /**\r\n     * 获取所有面板。\r\n     */\r\n    get panels() { return this.query(\".x-accordion>.x-panel\") as Panel[]; }\r\n\r\n    layout() {\r\n        let selectedIndex = this.selectedIndex;\r\n        if (selectedIndex < 0) selectedIndex = 0;\r\n        this.panels.forEach((panel, index) => {\r\n            panel.collapsable = true;\r\n            panel.onCollapseChange = this.handlePanelBeforeCollapseChange;\r\n            if (!this.multiply) {\r\n                panel.collapsed = index !== selectedIndex;\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 标记是否正在处理折叠事件。\r\n     */\r\n    private _ignoreChange: boolean;\r\n\r\n    /**\r\n     * 处理面板即将折叠事件。\r\n     * @param value 如果为 true 表示即将折叠。\r\n     * @param sender 事件源。\r\n     */\r\n    protected handlePanelBeforeCollapseChange = (value: boolean, sender: Panel) => {\r\n        if (this._ignoreChange) {\r\n            return;\r\n        }\r\n        if (!this.multiply) {\r\n            const selectedIndex = this.selectedIndex;\r\n            if (selectedIndex < 0) {\r\n                return;\r\n            }\r\n            if (this.panels[selectedIndex] !== sender) {\r\n                this._ignoreChange = true;\r\n                this.panels[selectedIndex].toggleCollapse(true);\r\n                this._ignoreChange = false;\r\n            } else if (value) {\r\n                return false;\r\n            }\r\n            this.selectedIndex = this.panels.indexOf(sender);\r\n        }\r\n        this.onCollapseChange && this.onCollapseChange(sender, this);\r\n    }\r\n\r\n}\r\n"],"mappings":";;;;;;;;IAKA;;OAEG;IACH,eAA+B,SAAQ,iBAAO;QAA9C;;YAoDI;;;;eAIG;YACO,oCAA+B,GAAG,CAAC,KAAc,EAAE,MAAa;gBACtE,EAAE,CAAC,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC;oBACrB,MAAM,CAAC;gBACX,CAAC;gBACD,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;oBACjB,MAAM,aAAa,GAAG,IAAI,CAAC,aAAa,CAAC;oBACzC,EAAE,CAAC,CAAC,aAAa,GAAG,CAAC,CAAC,CAAC,CAAC;wBACpB,MAAM,CAAC;oBACX,CAAC;oBACD,EAAE,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,aAAa,CAAC,KAAK,MAAM,CAAC,CAAC,CAAC;wBACxC,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;wBAC1B,IAAI,CAAC,MAAM,CAAC,aAAa,CAAC,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC;wBAChD,IAAI,CAAC,aAAa,GAAG,KAAK,CAAC;oBAC/B,CAAC;oBAAC,IAAI,CAAC,EAAE,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC;wBACf,MAAM,CAAC,KAAK,CAAC;oBACjB,CAAC;oBACD,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;gBACrD,CAAC;gBACD,IAAI,CAAC,gBAAgB,IAAI,IAAI,CAAC,gBAAgB,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;YACjE,CAAC,CAAA;QAEL,CAAC;QAhEG;;WAEG;QACH,IAAI,aAAa,KAAK,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,KAAK,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;QAChF,IAAI,aAAa,CAAC,KAAK;YACnB,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,KAAK,EAAE,KAAK;gBAC7B,KAAK,CAAC,SAAS,GAAG,KAAK,KAAK,KAAK,CAAC;YACtC,CAAC,CAAC,CAAC;QACP,CAAC;QAES,MAAM;YACZ,MAAM,CAAC,gCAAK,KAAK,EAAC,aAAa,GAAO,CAAC;QAC3C,CAAC;QAID;;WAEG;QACH,IAAI,MAAM,KAAK,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,uBAAuB,CAAY,CAAC,CAAC,CAAC;QAEvE,MAAM;YACF,IAAI,aAAa,GAAG,IAAI,CAAC,aAAa,CAAC;YACvC,EAAE,CAAC,CAAC,aAAa,GAAG,CAAC,CAAC;gBAAC,aAAa,GAAG,CAAC,CAAC;YACzC,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,KAAK,EAAE,KAAK;gBAC7B,KAAK,CAAC,WAAW,GAAG,IAAI,CAAC;gBACzB,KAAK,CAAC,gBAAgB,GAAG,IAAI,CAAC,+BAA+B,CAAC;gBAC9D,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;oBACjB,KAAK,CAAC,SAAS,GAAG,KAAK,KAAK,aAAa,CAAC;gBAC9C,CAAC;YACL,CAAC,CAAC,CAAC;QACP,CAAC;KAiCJ;IAlDa;QAAT,cAAI,CAAC,EAAE,CAAC;2CAAmB;IA5BhC,4BA8EC"}