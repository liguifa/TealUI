{"version":3,"file":"navMenu.js","sourceRoot":"../../..","sources":["components/ui/navMenu/navMenu.tsx"],"sourcesContent":["import * as dom from \"ux/dom\";\r\nimport pin from \"ux/pin\";\r\nimport Control, { VNode, bind } from \"ui/control\";\r\nimport \"typo/icon/icon.scss\";\r\nimport \"./navMenu.scss\";\r\n\r\n/**\r\n * 表示一个导航菜单。\r\n */\r\nexport default class NavMenu extends Control {\r\n    \r\n    protected render() {\r\n        return <nav class=\"x-navmenu\"></nav>;\r\n    }\r\n    \r\n    @bind(\"\") body: HTMLElement;\r\n\r\n    protected init() {\r\n        dom.on(this.elem, \"click\", \"li\", this.handleItemClick, this);\r\n        dom.on(this.elem, \"pointerenter\", \".x-navmenu-body>li\", this.handleItemPointerEnter, this);\r\n        dom.on(this.elem, \"pointerleave\", \".x-navmenu-body>li\", this.handleItemPointerLeave, this);\r\n    }\r\n\r\n    /**\r\n     * 当前激活项。\r\n     */\r\n    get activeItem() {\r\n        return dom.find(this.elem, \".x-navmenu-active\");\r\n    }\r\n    set activeItem(value) {\r\n        dom.query(this.elem, \".x-navmenu-active\").forEach(elem => {\r\n            dom.removeClass(elem, \"x-navmenu-active\");\r\n        });\r\n        if (value) {\r\n            dom.addClass(value, \"x-navmenu-active\");\r\n            while ((value = value.parentNode as HTMLElement)) {\r\n                if (dom.hasClass(value, \"x-navmenu-collapsable\")) {\r\n                    dom.removeClass(value, \"x-navmenu-collapsed\");\r\n                    dom.addClass(value, \"x-navmenu-active\");\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 点击项事件。\r\n     */\r\n    protected handleItemClick(e: MouseEvent, item: HTMLElement) {\r\n        this.activeItem = item;\r\n        if (dom.hasClass(item, \"x-navmenu-collapsable\")) {\r\n            if ((!this.collapsed || !dom.hasClass(item.parentNode as HTMLElement, \"x-navmenu-body\"))) {\r\n                const collapse = !dom.hasClass(item, \"x-navmenu-collapsed\");\r\n                dom.toggle(dom.last(item)!, !collapse, \"height\", undefined, this.duration);\r\n                dom.toggleClass(item, \"x-navmenu-collapsed\", collapse);\r\n            }\r\n        } else if (this.onItemClick) {\r\n            this.onItemClick(item, e);\r\n            if (this.collapsed) {\r\n                const popover = this.find(\".x-navmenu-popover\") as HTMLElement;\r\n                if (popover) {\r\n                    this.handleItemPointerLeave(e, this.activeItem = popover.parentNode as HTMLElement);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 是否显示折叠模式。\r\n     */\r\n    @bind(\"\", \"class\", \"x-navmenu-mini\") collapsed: boolean;\r\n\r\n    /**\r\n     * 项点击事件。\r\n     */\r\n    onItemClick: (item: HTMLElement, e: MouseEvent) => void;\r\n\r\n    onCollapseChange: () => void;\r\n\r\n    toggleCollapse() {\r\n        const show = this.collapsed;\r\n        if (show) {\r\n            const width = this.elem.offsetWidth;\r\n            this.collapsed = false;\r\n            const newWidth = this.elem.offsetWidth;\r\n            dom.setStyle(this.elem, \"width\", width);\r\n            dom.animate(this.elem, { width: newWidth }, () => {\r\n                dom.setStyle(this.elem, \"width\", \"\");\r\n            }, this.duration);\r\n        } else {\r\n            this.collapsed = true;\r\n            const width = this.elem.offsetWidth;\r\n            this.collapsed = false;\r\n            dom.animate(this.elem, { width: width }, () => {\r\n                dom.setStyle(this.elem, \"width\", \"\");\r\n                this.collapsed = true;\r\n            }, this.duration);\r\n        }\r\n        dom.query(this.elem, \".x-navmenu-collapsable:not(.x-navmenu-collapsed)>ul\").forEach(item => {\r\n            dom.toggle(item, show, \"height\", () => {\r\n                item.style.display = \"\";\r\n            }, this.duration);\r\n        });\r\n        this.onCollapseChange && this.onCollapseChange();\r\n    }\r\n\r\n    /**\r\n     * 鼠标移入折叠项事件。\r\n     */\r\n    protected handleItemPointerEnter(e: MouseEvent, item: HTMLElement) {\r\n        if (this.collapsed) {\r\n            this.activeItem = item;\r\n            if (dom.hasClass(item, \"x-navmenu-collapsable\")) {\r\n                const ul = dom.last(item)! as HTMLElement;\r\n                dom.addClass(ul, \"x-navmenu-popover\");\r\n                dom.addClass(ul, \"x-popover\");\r\n                dom.show(ul, \"opacity\", undefined, this.duration);\r\n                pin(ul, dom.first(item)!, \"rightTop\", 1, document);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 鼠标移出折叠项事件。\r\n     */\r\n    protected handleItemPointerLeave(e: MouseEvent, item: HTMLElement) {\r\n        if (this.collapsed && dom.hasClass(item, \"x-navmenu-collapsable\")) {\r\n            const ul = dom.last(item)! as HTMLElement;\r\n            dom.hide(ul, \"opacity\", () => {\r\n                dom.removeClass(ul, \"x-navmenu-popover\");\r\n                dom.removeClass(ul, \"x-popover\");\r\n            }, this.duration);\r\n        }\r\n    }\r\n\r\n}\r\n"],"mappings":"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"}