{"version":3,"file":"carousel.js","sourceRoot":"../../..","sources":["components/ui/carousel/carousel.tsx"],"sourcesContent":["import { Control, VNode, bind } from \"control\";\r\nimport \"./carousel.scss\";\r\n\r\n/**\r\n * 表示一个图片轮播。\r\n */\r\nexport class Carousel extends Control {\r\n\r\n    /**\r\n     * 当被子类重写时负责渲染当前控件。\r\n     * @return 返回一个虚拟节点。\r\n     */\r\n    protected render() {\r\n        return <div class=\"x-carousel\"></div>;\r\n    }\r\n\r\n}\r\n\r\nexport default Carousel;\r\n// #todo\r\n\r\n/**\r\n * @author xuld@vip.qq.com\r\n */\r\n\r\ntypeof include === \"function\" && include(\"ui/composite/carousel.css\");\r\ntypeof include === \"function\" && include(\"fx/animate.js\");\r\ntypeof include === \"function\" && include(\"ui/core/base.js\");\r\n\r\nvar Carousel = Control.extend({\r\n\r\n\tcssClass: 'x-carousel',\r\n\t\r\n\tonChange: function (from, to) {\r\n\t\tvar ul = Dom.find('.' + this.cssClass + '-header', this.elem), t;\r\n\t\tif (ul) {\r\n\t\t\tif (t = Dom.child(ul, from))\r\n\t\t\t\tDom.removeClass(t, this.cssClass + '-selected');\r\n\r\n\t\t\tif (t = Dom.child(ul, to))\r\n\t\t\t\tDom.addClass(t, this.cssClass + '-selected');\r\n\t\t}\r\n\t\t\r\n\t},\r\n\r\n    /**\r\n     * 当前标题正在显示的索引。\r\n     */\r\n\tcurrentIndex: 0,\r\n\r\n    duration: -1,\r\n\r\n    /**\r\n\t * 自动滚动的延时时间。\r\n\t */\r\n    delay: 4000,\r\n\t\r\n\tinit: function (options) {\r\n\r\n\t\tvar me = this,\r\n            width = Dom.getWidth(me.elem),\r\n            items = me.items = Dom.query('.' + this.cssClass + '-body > li', me.elem).hide();\r\n\r\n\t\tDom.query('.' + this.cssClass + '-header > li', me.elem).forEach(function (elem, index) {\r\n\t\t\tDom.setWidth(elem, width / items.length);\r\n\r\n\t\t\tDom.on(elem, options.event || 'mouseover', function (e) {\r\n\t\t\t\tme.moveTo(index);\r\n\t\t\t});\r\n\t\t});\r\n\t\t\r\n\t\tDom.show(items[0]);\r\n\t    me.onChange(null, 0);\r\n\r\n\t    me.start();\r\n\t},\r\n\r\n\t_slideTo: function (fromIndex, toIndex, ltr) {\r\n\r\n\t    var me = this,\r\n            width = Dom.getWidth(me.elem);\r\n\r\n\t    // 如果正在执行渐变，则记录 toIndex 为 finalIndex 。当前特效执行结束后回调函数继续处理 oldIndex 。\r\n\t    if (me.animatingIndex == null) {\r\n\r\n\t        // 如果目前没有执行特效。记录当前正在渐变到指定的索引。下次执行函数时，可以监测到当前正在执行渐变。\r\n\t        me.animatingIndex = toIndex;\r\n\r\n\t        me.items.hide();\r\n\r\n\t        // 如果需要从左渐变至右。\r\n\t        if (!ltr) {\r\n\t            width = -width;\r\n\t        }\r\n\r\n\t        Dom.show(me.items[fromIndex]);\r\n\t        me.items[fromIndex].style.left = 0;\r\n\r\n\t        Dom.show(me.items[toIndex]);\r\n\t        me.items[toIndex].style.left = width + 'px';\r\n\r\n\t        Dom.animate(me.items[0].parentNode, {\r\n\t            left: '0-' + -width\r\n\t        }, this.duration, function () {\r\n\r\n\t            var animatingIndex = me.animatingIndex;\r\n\t            var finalIndex = me.finalIndex;\r\n\r\n\t            // 效果执行完成。\r\n\t            me.animatingIndex = null;\r\n\r\n\t            // 如果正在执行特效时又重新执行了 _slideTo 则 finalIndex 非空。\r\n\t            if (finalIndex != null && finalIndex !== animatingIndex) {\r\n\t                me.finalIndex = null;\r\n\t                me._slideTo(animatingIndex, finalIndex, animatingIndex < finalIndex);\r\n\t            }\r\n\t        });\r\n\r\n\t    } else {\r\n\t        me.finalIndex = toIndex;\r\n\t    }\r\n\r\n\t    return toIndex;\r\n\r\n\t},\r\n\r\n\tmoveTo: function (index, ltr) {\r\n\r\n\t    var timer = this.timer,\r\n\t        currentIndex = this.currentIndex;\r\n\r\n\t    if (timer) {\r\n\t        clearTimeout(timer);\r\n\t    }\r\n\r\n\t    if (index != currentIndex) {\r\n\t    \tindex %= this.items.length;\r\n\t        this.currentIndex = index;\r\n\t        this.onChange(currentIndex, index);\r\n\t        this._slideTo(currentIndex, index, ltr || currentIndex < index);\r\n\t    }\r\n\r\n\t    if (timer) {\r\n\t        this.timer = setTimeout(this.step, this.delay);\r\n\t    }\r\n\r\n\t    return this;\r\n\r\n\t},\r\n\r\n\tmoveBy: function (delta) {\r\n\t    return this.moveTo(this.currentIndex + delta);\r\n\t},\r\n\r\n\tprev: function () {\r\n\t    return this.moveBy(-1);\r\n\t},\r\n\r\n\tnext: function () {\r\n\t    return this.moveBy(1);\r\n\t},\r\n\r\n\tstart: function () {\r\n\t    var me = this;\r\n\t    if (!me.timer) {\r\n\t    \tme.step = function () {\r\n\t    \t\tme.moveTo(me.currentIndex + 1, true);\r\n\t    \t};\r\n\t        me.timer = setTimeout(me.step, me.delay);\r\n\t    }\r\n\t    return me;\r\n\t},\r\n\r\n\tstop: function () {\r\n\t    if (this.timer) {\r\n\t        clearTimeout(this.timer);\r\n\t        this.timer = 0;\r\n\t    }\r\n\t    return this;\r\n\t}\r\n\r\n});\r\n\r\n"],"mappings":"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"}