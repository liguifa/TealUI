{"version":3,"file":"comboBox.js","sourceRoot":"../../..","sources":["components/ui/comboBox/comboBox.tsx"],"sourcesContent":["import * as dom from \"ux/dom\";\r\nimport { scrollIntoViewIfNeeded } from \"ux/scroll\";\r\nimport keyPress from \"ux/keyPress\";\r\nimport Control, { VNode, bind, from } from \"ui/control\";\r\nimport Picker from \"ui/picker\";\r\nimport ListBox, { ListItem } from \"ui/listBox\";\r\nimport \"typo/icon\";\r\n\r\n/**\r\n * 表示一个组合框。\r\n */\r\nexport default class ComboBox extends Picker {\r\n\r\n    menu: ListBox;\r\n\r\n    protected createMenu() {\r\n        return new ListBox();\r\n    }\r\n\r\n    protected init() {\r\n        super.init();\r\n        dom.on(this.menu.body, \"pointermove\", \"li\", (e, item: HTMLElement) => {\r\n            this.menu.selectedItem = from(item) as ListItem;\r\n        });\r\n        this.menu.onSelect = (item, e) => {\r\n            if (!(e as any)._ignore) {\r\n                this.handleMenuSelect(item, e);\r\n            }\r\n        };\r\n        const mappings = this.menu.keyMappings();\r\n        keyPress(this.input, {\r\n            up: (e) => {\r\n                if (this.dropDown.hidden) {\r\n                    this.dropDown.show();\r\n                } else {\r\n                    (e as any)._ignore = true;\r\n                    mappings.up(e);\r\n                }\r\n            },\r\n            down: (e) => {\r\n                if (this.dropDown.hidden) {\r\n                    this.dropDown.show();\r\n                } else {\r\n                    (e as any)._ignore = true;\r\n                    mappings.down(e);\r\n                }\r\n            },\r\n            enter: (e) => {\r\n                if (this.dropDown.hidden) {\r\n                    return true;\r\n                }\r\n                const item = this.menu.selectedItem;\r\n                if (item) this.menu.onSelect(item, e, this.menu);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 处理项选中事件。\r\n     */\r\n    protected handleMenuSelect(item: ListItem, e: UIEvent) {\r\n        this.value = item.content;\r\n        this.dropDown.hide();\r\n        this.onChange && this.onChange(e, this);\r\n    }\r\n\r\n    protected updateMenu() {\r\n        this.menu.value = this.value;\r\n        const item = this.menu.selectedItem;\r\n        if (item) {\r\n            scrollIntoViewIfNeeded(item.elem, this.menu.body, 0);\r\n        }\r\n    }\r\n\r\n}\r\n"],"mappings":";;IAQA;;OAEG;IACH,cAA8B,SAAQ,gBAAM;QAI9B,UAAU;YAChB,MAAM,CAAC,IAAI,iBAAO,EAAE,CAAC;QACzB,CAAC;QAES,IAAI;YACV,KAAK,CAAC,IAAI,EAAE,CAAC;YACb,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,aAAa,EAAE,IAAI,EAAE,CAAC,CAAC,EAAE,IAAiB;gBAC7D,IAAI,CAAC,IAAI,CAAC,YAAY,GAAG,cAAI,CAAC,IAAI,CAAa,CAAC;YACpD,CAAC,CAAC,CAAC;YACH,IAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,CAAC,IAAI,EAAE,CAAC;gBACzB,EAAE,CAAC,CAAC,CAAE,CAAS,CAAC,OAAO,CAAC,CAAC,CAAC;oBACtB,IAAI,CAAC,gBAAgB,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;gBACnC,CAAC;YACL,CAAC,CAAC;YACF,MAAM,QAAQ,GAAG,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC;YACzC,kBAAQ,CAAC,IAAI,CAAC,KAAK,EAAE;gBACjB,EAAE,EAAE,CAAC,CAAC;oBACF,EAAE,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC;wBACvB,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC;oBACzB,CAAC;oBAAC,IAAI,CAAC,CAAC;wBACH,CAAS,CAAC,OAAO,GAAG,IAAI,CAAC;wBAC1B,QAAQ,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;oBACnB,CAAC;gBACL,CAAC;gBACD,IAAI,EAAE,CAAC,CAAC;oBACJ,EAAE,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC;wBACvB,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC;oBACzB,CAAC;oBAAC,IAAI,CAAC,CAAC;wBACH,CAAS,CAAC,OAAO,GAAG,IAAI,CAAC;wBAC1B,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;oBACrB,CAAC;gBACL,CAAC;gBACD,KAAK,EAAE,CAAC,CAAC;oBACL,EAAE,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC;wBACvB,MAAM,CAAC,IAAI,CAAC;oBAChB,CAAC;oBACD,MAAM,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC;oBACpC,EAAE,CAAC,CAAC,IAAI,CAAC;wBAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;gBACrD,CAAC;aACJ,CAAC,CAAC;QACP,CAAC;QAED;;WAEG;QACO,gBAAgB,CAAC,IAAc,EAAE,CAAU;YACjD,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,OAAO,CAAC;YAC1B,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC;YACrB,IAAI,CAAC,QAAQ,IAAI,IAAI,CAAC,QAAQ,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC;QAC5C,CAAC;QAES,UAAU;YAChB,IAAI,CAAC,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC;YAC7B,MAAM,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC;YACpC,EAAE,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;gBACP,+BAAsB,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;YACzD,CAAC;QACL,CAAC;KAEJ;IA/DD,2BA+DC"}