{"version":3,"file":"picker.js","sourceRoot":"../../..","sources":["components/ui/picker/picker.tsx"],"sourcesContent":["import * as dom from \"ux/dom\";\r\nimport Control, { VNode, bind } from \"ui/control\";\r\nimport Input from \"ui/input\";\r\nimport { Popup } from \"ux/popup\";\r\nimport { Status, getStatus, setStatus } from \"ux/status\";\r\nimport \"ui/textBox/textBox.scss\";\r\nimport \"ui/button/button.scss\";\r\nimport \"./picker.scss\";\r\n\r\n/**\r\n * 表示一个填选器。\r\n */\r\nexport default class Picker extends Input {\r\n\r\n    protected render() {\r\n        return <span class=\"x-picker\">\r\n            <input type=\"text\" class=\"x-textbox\" autocomplete=\"off\" />\r\n            <button type=\"button\" class=\"x-button\" tabIndex={-1}><i class=\"x-icon\">⮟</i></button>\r\n        </span>;\r\n    }\r\n\r\n    /**\r\n     * 按钮。\r\n     */\r\n    @bind(\".x-button\") button: HTMLButtonElement;\r\n\r\n    /**\r\n     * 图标。\r\n     */\r\n    @bind(\".x-button .x-icon\", \"innerHTML\") icon: string;\r\n\r\n    get status() {\r\n        return getStatus(this.input, this.statusClassPrefix);\r\n    }\r\n\r\n    set status(value) {\r\n        setStatus(this.input, this.statusClassPrefix, value);\r\n    }\r\n\r\n    get disabled() {\r\n        return this.input.disabled;\r\n    }\r\n    set disabled(value) {\r\n        this.button.disabled = this.input.disabled = value;\r\n    }\r\n\r\n    get readOnly() {\r\n        return this.input.readOnly && this.button.disabled;\r\n    }\r\n    set readOnly(value) {\r\n        this.button.disabled = this.input.readOnly = value;\r\n        dom.toggleClass(this.elem, \"x-picker-readonly\", value);\r\n    }\r\n\r\n    /**\r\n     * 是否允许用户输入。\r\n     */\r\n    get canInput() {\r\n        return !dom.hasClass(this.elem, \"x-picker-select\");\r\n    }\r\n    set canInput(value) {\r\n        dom.toggleClass(this.elem, \"x-picker-select\", !value);\r\n        this.input.readOnly = !value;\r\n    }\r\n\r\n    /**\r\n     * 是否允许用户选择。\r\n     */\r\n    get canSelect() {\r\n        return !dom.isHidden(this.button);\r\n    }\r\n    set canSelect(value) {\r\n        dom.toggle(this.button, !value);\r\n    }\r\n\r\n    /**\r\n     * 下拉菜单。\r\n     */\r\n    dropDown = new Popup();\r\n\r\n    /**\r\n     * 下拉菜单的选项。\r\n     */\r\n    dropDownOptions: Partial<Popup>;\r\n\r\n    /**\r\n     * 菜单控件。\r\n     */\r\n    menu: Control;\r\n\r\n    protected init() {\r\n        super.init();\r\n        this.menu.renderTo(this.elem);\r\n        dom.addClass(this.menu.elem, \"x-popup\");\r\n        if (this.resizeMode === \"fitDropDown\") {\r\n            dom.setRect(this.elem, { width: dom.getRect(this.menu.elem).width });\r\n        }\r\n        dom.hide(this.menu.elem);\r\n\r\n        const dropDown = this.dropDown;\r\n        dropDown.elem = this.menu.elem;\r\n        dropDown.target = this.button;\r\n        dropDown.pinTarget = this.elem;\r\n        dropDown.align = \"bottomLeft\";\r\n        dropDown.event = \"click\";\r\n        dropDown.onShow = () => {\r\n            this.handleDropDownShow();\r\n        };\r\n        dropDown.onHide = () => {\r\n            this.handleDropDownHide();\r\n        };\r\n        Object.assign(dropDown, this.dropDownOptions);\r\n        dropDown.enable();\r\n\r\n        dom.on(this.button, \"click\", this.input.focus, this.input);\r\n    }\r\n\r\n    /**\r\n     * 当被子类重写时负责创建一个下拉菜单。\r\n     */\r\n    protected createMenu() {\r\n        return new Control();\r\n    }\r\n\r\n    /**\r\n     * 当被子类重写时负责更新下拉菜单的值。\r\n     */\r\n    protected updateMenu() { }\r\n\r\n    /**\r\n     * 下拉菜单显示事件。\r\n     * @param sender 事件源。\r\n     */\r\n    onDropDownShow: (sender: this) => void;\r\n\r\n    /**\r\n     * 下拉菜单隐藏事件。\r\n     * @param sender 事件源。\r\n     */\r\n    onDropDownHide: (sender: this) => void;\r\n\r\n    /**\r\n     * 下拉框大小模式。\r\n     * - auto（默认）: 确保下拉菜单比文本框宽度大。\r\n     * - fitInput: 下拉菜单适应文本框宽度。\r\n     * - fitDropDown: 文本框适应下拉菜单宽度。\r\n     */\r\n    resizeMode: \"fitInput\" | \"fitDropDown\" | \"auto\";\r\n\r\n    /**\r\n     * 处理下拉菜单显示事件。\r\n     */\r\n    protected handleDropDownShow() {\r\n        if (this.disabled || this.readOnly) {\r\n            this.dropDown.hide();\r\n            return;\r\n        }\r\n        this.updateMenu();\r\n        if (this.resizeMode !== \"fitDropDown\") {\r\n            const elemWidth = dom.getRect(this.elem).width;\r\n            if (this.resizeMode === \"fitInput\" || dom.getRect(this.dropDown.elem).width < elemWidth) {\r\n                dom.setRect(this.dropDown.elem, { width: elemWidth });\r\n            }\r\n        }\r\n        this.dropDown.realign();\r\n        this.onDropDownShow && this.onDropDownShow(this);\r\n    }\r\n\r\n    /**\r\n     * 处理下拉菜单隐藏事件。\r\n     */\r\n    protected handleDropDownHide() {\r\n        this.onDropDownHide && this.onDropDownHide(this);\r\n    }\r\n\r\n}\r\n\r\nPicker.prototype.statusClassPrefix = \"x-textbox-\";\r\nPicker.prototype.resizeMode = \"auto\";\r\nPicker.prototype.validateEvent = \"input\";\r\n"],"mappings":"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"}