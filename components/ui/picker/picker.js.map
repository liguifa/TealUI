{"version":3,"file":"picker.js","sourceRoot":"../../..","sources":["components/ui/picker/picker.tsx"],"sourcesContent":["import * as dom from \"ux/dom\";\r\nimport Control, { VNode, bind } from \"ui/control\";\r\nimport Input from \"ui/input\";\r\nimport { Popup } from \"ux/popup\";\r\nimport { Status, getStatus, setStatus } from \"ux/status\";\r\nimport \"ui/textBox/textBox.scss\";\r\nimport \"ui/button/button.scss\";\r\nimport \"./picker.scss\";\r\n\r\n/**\r\n * 表示一个填选器。\r\n */\r\nexport default class Picker extends Input {\r\n\r\n    protected render() {\r\n        return <span class=\"x-picker\">\r\n            <input type=\"text\" class=\"x-textbox\" autocomplete=\"off\" />\r\n            <button type=\"button\" class=\"x-button\" tabIndex={-1}><i class=\"x-icon\">⮟</i></button>\r\n        </span>;\r\n    }\r\n\r\n    /**\r\n     * 按钮。\r\n     */\r\n    @bind(\".x-button\") button: HTMLButtonElement;\r\n\r\n    /**\r\n     * 图标。\r\n     */\r\n    @bind(\".x-button .x-icon\", \"innerHTML\") icon: string;\r\n\r\n    get disabled() {\r\n        return this.input.disabled && this.button.disabled;\r\n    }\r\n    set disabled(value) {\r\n        this.button.disabled = this.input.disabled = value;\r\n    }\r\n\r\n    get readOnly() {\r\n        return this.input.readOnly && this.button.disabled;\r\n    }\r\n    set readOnly(value) {\r\n        this.button.disabled = this.input.readOnly = value;\r\n    }\r\n\r\n    /**\r\n     * 存储下拉菜单控件。\r\n     */\r\n    private _menu: Control;\r\n\r\n    /**\r\n     * 下拉菜单控件。\r\n     */\r\n    get menu() {\r\n        let menu = this._menu;\r\n        if (!menu) {\r\n            this._menu = menu = this.createMenu();\r\n            menu.renderTo(this.elem);\r\n            dom.addClass(menu.elem, \"x-popup\");\r\n            this.menu = menu;\r\n        }\r\n        return this._menu;\r\n    }\r\n    set menu(value) {\r\n        this._menu = Object.assign(value, this.menuOptions);\r\n        if (this.resizeMode === \"fitDropDown\") {\r\n            dom.show(value.elem);\r\n            dom.setRect(this.elem, { width: dom.getRect(value.elem).width });\r\n        }\r\n        dom.hide(value.elem);\r\n    }\r\n\r\n    /**\r\n     * 下拉菜单控件的选项。\r\n     */\r\n    menuOptions: any;\r\n\r\n    /**\r\n     * 下拉框大小模式。\r\n     * - auto（默认）: 确保下拉菜单比文本框宽度大。\r\n     * - fitInput: 下拉菜单适应文本框宽度。\r\n     * - fitDropDown: 文本框适应下拉菜单宽度。\r\n     */\r\n    resizeMode: \"auto\" | \"fitInput\" | \"fitDropDown\";\r\n\r\n    get body() { return this.menu.body; }\r\n\r\n    /**\r\n     * 存储下拉菜单。\r\n     */\r\n    private _dropDown: Popup;\r\n\r\n    /**\r\n     * 下拉菜单。\r\n     */\r\n    get dropDown() {\r\n        let dropDown = this._dropDown;\r\n        if (!dropDown) {\r\n            dropDown = new Popup();\r\n            dropDown.elem = this.menu.elem;\r\n            dropDown.target = this.input;\r\n            dropDown.pinTarget = this.elem;\r\n            dropDown.align = \"bottomLeft\";\r\n            dropDown.event = \"focusin\";\r\n            dropDown.animation = \"scaleY\";\r\n            this.dropDown = dropDown;\r\n        }\r\n        return dropDown;\r\n    }\r\n    set dropDown(value) {\r\n        this._dropDown = value;\r\n        value.onShow = this.handleDropDownShow.bind(this);\r\n        value.onHide = this.handleDropDownHide.bind(this);\r\n        Object.assign(value, this.dropDownOptions);\r\n    }\r\n\r\n    /**\r\n     * 下拉菜单的选项。\r\n     */\r\n    dropDownOptions: Partial<Popup>;\r\n\r\n    protected init() {\r\n        super.init();\r\n\r\n        // 初始化下拉效果。\r\n        this.dropDown.enable();\r\n\r\n        // 初始化按钮。\r\n        dom.on(this.button, \"click\", this.input.select, this.input);\r\n        dom.on(this.input, \"input\", this.handleInput, this);\r\n    }\r\n\r\n    /**\r\n     * 当被子类重写时负责创建下拉菜单。\r\n     */\r\n    protected createMenu() {\r\n        return new Control();\r\n    }\r\n\r\n    /**\r\n     * 当被子类重写时负责更新下拉菜单的值。\r\n     */\r\n    protected updateMenu() { }\r\n\r\n    /**\r\n     * 下拉菜单显示事件。\r\n     * @param sender 事件源。\r\n     */\r\n    onDropDownShow: (sender: this) => void;\r\n\r\n    /**\r\n     * 下拉菜单隐藏事件。\r\n     * @param sender 事件源。\r\n     */\r\n    onDropDownHide: (sender: this) => void;\r\n\r\n    /**\r\n     * 处理下拉菜单显示事件。\r\n     */\r\n    protected handleDropDownShow() {\r\n        if (this.disabled || this.readOnly) {\r\n            this.dropDown.hide();\r\n            return;\r\n        }\r\n        this.updateMenu();\r\n        if (this.resizeMode !== \"fitDropDown\") {\r\n            const elemWidth = dom.getRect(this.elem).width;\r\n            if (this.resizeMode === \"fitInput\" || dom.getRect(this.dropDown.elem).width < elemWidth) {\r\n                dom.setRect(this.dropDown.elem, { width: elemWidth });\r\n            }\r\n        }\r\n        this.onDropDownShow && this.onDropDownShow(this);\r\n    }\r\n\r\n    /**\r\n     * 处理下拉菜单隐藏事件。\r\n     */\r\n    protected handleDropDownHide() {\r\n        this.onDropDownHide && this.onDropDownHide(this);\r\n    }\r\n\r\n    /**\r\n     * 处理输入事件。\r\n     */\r\n    protected handleInput() {\r\n        if (!this.dropDown.hidden) {\r\n            this.updateMenu();\r\n        }\r\n    }\r\n\r\n}\r\n\r\nPicker.prototype.statusClassPrefix = \"x-textbox-\";\r\nPicker.prototype.resizeMode = \"auto\";\r\nPicker.prototype.validateEvent = \"input\";\r\n"],"mappings":"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"}